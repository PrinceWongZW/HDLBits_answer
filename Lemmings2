module top_module(
    input clk,
    input areset,    // Freshly brainwashed Lemmings walk left.
    input bump_left,
    input bump_right,
    input ground,
    output walk_left,
    output walk_right,
    output aaah ); 
    
    parameter LEFT = 0, RIGHT = 1, FALLL = 2, FALLR = 3;
    
    reg [2:0] state, nstate;
    
    always @ (*) begin
        case(state)
            LEFT : begin
                if(~ground) nstate = FALLL;
                else if(bump_left) nstate = RIGHT;
                else nstate = state;
            end
            
            RIGHT : begin
                if(~ground) nstate = FALLR;
                else if(bump_right) nstate = LEFT;
                else nstate = state;
            end
            
            FALLL : begin
                nstate = ground ? LEFT : state;
            end
            
            FALLR : begin
                nstate = ground ? RIGHT : state;
            end
        endcase
    end
    
    always @ (posedge clk, posedge areset) begin
        if(areset) state <= LEFT;
        else state <= nstate;
    end
    
    assign walk_left = (state==LEFT);
    assign walk_right = (state==RIGHT);
    assign aaah = (state==FALLL) | (state==FALLR);

endmodule
